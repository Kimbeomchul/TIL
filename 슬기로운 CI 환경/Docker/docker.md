# Docker

### 시작
- 이미지 생성과정

  + 도커이미지 -> 임시컨테이너로 이동 -> 이미지생성 
  + 이후 임시 컨테이너는 삭- 제 

- 연습삼아 도커이미지를 생성하기 ( npm 사용 )
  + FROM node:10
  + COPY package.json ./    => <( npm install을 위해선 package.json파일이필요하다. 임시 컨테이너로 복사 ? )
  + COPY시 여러파일 copy를 하려면 COPY ./ ./ 를 하면 폴더전체를 복사한다. 
  + RUN npm install
  + CMD ["node","main.js]


### PORT 매핑하기
- docker run -p <포트> : 8080 <이미지이름>
  + 도커의 컨테이너에 접속하기 위해서는 브라우저 주소에 작성하는 포트와 컨테이터 포트의 매핑이 필요함.
  + 매핑을 위해서 -p (port) 명령어로 실행을 시켜 매핑run 

### WORKDIR
- 그냥 이미지를 생성시 copy한 파일들과 여러가지 파일들이 혼합되어있다. 이를 해결하기위해 지정이 필요!
  + WORKDIR /the/workdir/path 를 설정해주면 끝~

### 간단명령
- docker stop <이미지id>  => 멈추기
- docker run -d -p 8090:8080 <명명> =>  ( -d : 실행후 터미널로 바로나옴 ) , ( -p 8090:8080 => 포트 080으로설정해놓은 파일을 8090으로 켜지도록 매핑 )

### 효율적인 빌드 
- 좀더 효율적으로 빌드하기위해선 종속성과같은 파일은 따로 COPY를 진행해서 install을 해놓고 이후에 따로 파일들을 COPY해 사용하면 빌드시간이 줄어든다.

### 도커 볼륨 ( Docker Volume )
- 도커는 빌드시 COPY 명령어로 받아왔었기때문에 소스가 변경되면 재빌드를 해야 변경됨 ( 비효율적 )
  + 해결방안 ( 볼륨이용 )
- 도커볼륨이란 ? 
  + COPY는 로컬의 파일을 도커 컨테이너로 복사하는 형식이였다면, 볼륨은 도커 컨테이너가 로컬의 경로에 있는 파일을 참조하는 형식이다. ( 매핑이라 봐야하나 ..? ) 이를 이용하게되면 재빌드를 하지않고 재실행만으로 변환된다.
- 사용법
  + Node.js 기준 npm이 다운받아지는 node_modules가 컨테이너 안에있으므로 제외시키고 시작
  + docker run -p 8090:8080 -v /usr/src/app/node_modules -v $(pwd):/usr/src/app < 이미지 아이디 >
  + 앞부분의 run -p <포트>는 앞서 적어놨으니 생략하고 뒤의 -v 부분은 node_modules를 생략하는 명령어이다. 이후 나오는 pwd부분은 복사할 로컬파일의 위치를 나타낸다.
  + 소스를 변경 후 도커재실행을해야 적용된다.
- Tip
  + docker stop <이미지명> 을 작성시 이미지명이 1e2e29192e식이라면 같이 실행중인 이미지명과 겹치지 않는 선에서 1e2 이런식으로 작성해도 정상종료된다.
  


### Docker 사용 자동화 프로젝트
- Node.js / AWS / 젠킨스?(미정) .... 
